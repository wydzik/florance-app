{% extends "base.html" %}

{% block content %}
<h2>Witaj w aplikacji!</h2>

{% if user.is_authenticated %}
    <h3>Twoje realizacje</h3>

    {% if realizacje %}
        <!-- Filtrowanie po pracowni -->
        <form method="get" class="mb-3">
            <label for="pracownia">Filtruj po pracowni:</label>
            <select name="pracownia" id="pracownia" class="form-select w-auto d-inline-block">
                <option value="">Wszystkie pracownie</option>
                {% for p in pracownie %}
                    <option value="{{ p.id }}" {% if selected_pracownia == p.id|stringformat:"s" %}selected{% endif %}>
                        {{ p.nazwa }}
                    </option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </form>

        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Event</th>
                    <th>Pracownia</th>
                    <th>Miejsce</th>
                    <th>Data rozpoczęcia</th>
                    <th>Data zakończenia</th>
                    <th>Akcje</th>
                </tr>
            </thead>
            <tbody>
                {% for r in realizacje %}
                <tr>
                    <td><a href="{% url 'realizacja_detail' r.id %}">{{ r.nazwa_eventu }}</a></td>
                    <td>{{ r.pracownia.nazwa }}</td>
                    <td>{{ r.miejsce }}</td>
                    <td>{{ r.data_rozpoczecia|date:"d-m-Y H:i" }}</td>
                    <td>{{ r.data_zakonczenia|date:"d-m-Y H:i" }}</td>
                    <td>
                        <a href="{% url 'edit_realizacja' r.id %}" class="btn btn-sm btn-warning">Edytuj</a>
                        <a href="{% url 'delete_realizacja' r.id %}" class="btn btn-sm btn-danger">Usuń</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <a href="{% url 'create_realizacja' %}" class="btn btn-primary">Dodaj nową realizację</a>
    {% else %}
        <p>Nie masz jeszcze żadnych realizacji.</p>
        <a href="{% url 'create_realizacja' %}" class="btn btn-primary">Dodaj pierwszą realizację</a>
    {% endif %}
{% else %}
    <p>Nie jesteś zalogowany. <a href="{% url 'login' %}">Zaloguj się</a> lub <a href="{% url 'register' %}">zarejestruj się</a>.</p>
{% endif %}
{% endblock %}
